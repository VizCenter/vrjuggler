<HTML>

<!-- $Id$ -->

<HEAD>
  <TITLE>Use of the VR Juggler configure Script</TITLE>
</HEAD>

<BODY
    TEXT="#000000" BGCOLOR="#FFFFFF"
    LINK="#0000EE" VLINK="#551A8B" ALINK="#FF0000">

<DIV ALIGN="CENTER">
<H1>Configure Script Guide</H1>
</DIV>

<HR WIDTH="80%" NOSHADE>

<H3>Usage</H3>

Use of the <I>configure</I> script and its accompanying template files is
designed to be as simple as possible at the user level.  It provides a
platform-independent method for creating platform-specific Makefiles that can
be used to build VR Juggler for the target platform.  The following example
illustrates the typical way to use the <I>configure</I> script:

<OL>
  <LI><B><TT>cd <I>path/to/source/juggler</I></TT></B>
  <LI><B><TT>mkdir <I>build</I></TT></B>
  <LI><B><TT>cd <I>build</I></TT></B>
  <LI><B><TT>../configure <I>--user-options-here</I></TT></B>
  <LI><B><TT>gmake</TT></B>
</OL>

The directory named ``<TT>build</TT>'' in this example can actually
be put anywhere--it does not have to be a subdirectory of <TT>juggler</TT>.
It can also be given any name desired.  In fact, the directory does not even
need to be used, but doing so will not give the full functionality offered by
building in a subdirectory.

<P>

The above example results in the library object files and the library itself
being built in separate <TT>obj</TT> and <TT>lib</TT> subdirectories of
<TT>build</TT> respectively.  If you are building a debugging version of the
library on IRIX with compiler options <TT>-n32&nbsp;-mips3</TT>, the
subdirectory where the final library will be is <TT>lib32/mips3/debug</TT>,
and the object files will all be in <TT>obj/SGI/N32/mips3/debug</TT>.  As a
result of following the above steps, there will be no pollution of the base
VR Juggler source tree with object files, library binaries, compile-time
directories, etc.  It all goes in <TT>build</TT> and can all be removed
quickly and easily by removing that directory.  Thus, the source tree becomes
entirely read-only from the perspective of the build process.  What follows
is a list of what actually goes in <TT>build</TT>.

<DL>
  <DT><B>Makefiles</B>
    <DD><I>configure</I> generates a tree of Makefiles from the
	<TT>Makefile.in</TT> template files found in the base Juggler source
	tree.  In so doing, it creates a copy of the source tree that
	contains only those Makefiles until things start getting compiled.
	<I>gmake</I>(1) (which is required by all the Makefiles except those
	in the <TT>test</TT> subtree) will recurse through the directory tree
	to build all the object files and the final library binaries.  The
	following diagram illustrates the tree created by <I>configure</I>:

<PRE>                              <B>Directories created by <I>configure</I>:</B>

 juggler -+-- build ----------\
          +-- Config          +-- Config
          +-- GUI ---+-- ...  +-- GUI
          |          \-- ...  |
          |                   |
          +-- Environment     +-- Environment
          +-- Kernel +-- GL   +-- Kernel -----+-- GL
          |          \-- Pf   |               \-- Pf
          |                   |
          +-- Kernel          +-- Input ------+-- InputManager
          +-- Math            +-- Math        +-- ...
          +-- ...             +-- Performance :
          :                   +-- SharedMem   :
          :                   +-- Sync
                              +-- Threads
                              \-- test -------+-- CfgTest
                                              +-- Quat
                                              +-- Sync
                                              +-- input
                                              +-- ogl ----+-- cubes
                                              |           \-- wand
                                              |
                                              +-- pfNav
                                              :
                                              :
</PRE>

	Two or more directory trees are created within <TT>build</TT> during
	the build process.  The first tree holds the compiled object files,
	and the remaining tress hold the built libraries.  The structure is
	as follows:

<PRE>
 ... build -+-- obj -------+-- SGI ---+-- N32 ---+-- mips3 -+-- debug
            |              |          |          |          \-- opt
            |              :          |          \-- mips4 -+-- debug
            |              :          |                     \-- opt
            |                         \-- 64 ----+-- mips3 -+-- debug
            |                                    |          \-- opt
            |                                    \-- mips4 -+-- debug
            |                                               \-- opt
            |
            +-- lib32 -----+-- mips3 -+-- debug
            |              |          \-- opt
            |              \-- mips4 -+-- debug
            |                         \-- opt
            |
            \-- lib64 -----+-- mips3 -+-- debug
                           |          \-- opt
                           \-- mips4 -+-- debug
                                      \-- opt
</PRE>

	The tree shown here is what results from making the
	``<TT>all-abi</TT>'' target on an SGI.  When building a single ABI,
	only that directory is created under <TT>obj</TT>.  As can be seen,
	this structure allows object files to be built for more than one
	platform in the same <TT>obj</TT> directory.  However, it is unlikely
	that this functionality would ever be very useful since different
	Makefiles are needed for different platforms.
  <DT><B>Object files</B>
    <DD>As all compilations do, the build process creates the object files
	needed to make the VR Juggler library.  These files go in a directory
	named by the <TT>${OBJDIR}</TT> variable.  The default value for this
	variable is the current directory, but the recursion process
	overrides this default with the <TT>obj/...</TT> directory mentioned
	above.
  <DT><B>Library binaries</B>
    <DD>The actual library binaries ...
</DL>

<P>

<HR WIDTH="80%" NOSHADE>

<H3>Run-Time Options</H3>

As of this writing, <I>configure</I> has the following run-time options:

<DL>
  <DT><B>--with-abi=[O32|N32_M3|N32_M4|64_M3|64_M4]</B>
    <DD>Define the Application Binary Interface to use.  The default is
	<TT>N32_M3</TT>.  These names correspond to compiler options as
	follows:

	<P>

	<DIV ALIGN="CENTER">
	<TABLE BORDER="1" WIDTH="500">
	  <TR>
	    <TH BGCOLOR="#d0d0d0">
	      Name
	    </TH>
	    <TH BGCOLOR="#d0d0d0">
	      Compiler Options
	    </TH>
	    <TH BGCOLOR="#d0d0d0">
	      Description
	    </TH>
	  </TR>
	  <TR>
	    <TD ALIGN="RIGHT">
	      <TT>O32</TT>
	    </TD>
	    <TD ALIGN="CENTER">
	      <TT>-o32 -mips2</TT>
	    </TD>
	    <TD>
	      Build an old 32-bit binary (standard on IRIX 5 systems) using
	      the mips2 instruction set architecture (ISA)--<B>this is
              currently not possible</B>
	    </TD>
	  </TR>
	  <TR>
	    <TD ALIGN="RIGHT">
	      <TT>N32_M3</TT>
	    </TD>
	    <TD ALIGN="CENTER">
	      <TT>-n32 -mips3</TT>
	    </TD>
	    <TD>
	      Build a new, high-performance 32-bit binary (introduced on
	      IRIX 6.2) using the mips3 ISA
	    </TD>
	  </TR>
	  <TR>
	    <TD ALIGN="RIGHT">
	      <TT>N32_M4</TT>
	    </TD>
	    <TD ALIGN="CENTER">
	      <TT>-n32 -mips4</TT>
	    </TD>
	    <TD>
	      Build a new, high-performance 32-bit binary (introduced on
	      IRIX 6.2) using the mips4 ISA
	    </TD>
	  </TR>
	  <TR>
	    <TD ALIGN="RIGHT">
	      <TT>64_M3</TT>
	    </TD>
	    <TD ALIGN="CENTER">
	      <TT>-64 -mips3</TT>
	    </TD>
	    <TD>
	      Build a 64-bit binary (introduced on IRIX 6.0) using the mips3
	      ISA
	    </TD>
	  </TR>
	  <TR>
	    <TD ALIGN="RIGHT">
	      <TT>64_M4</TT>
	    </TD>
	    <TD ALIGN="CENTER">
	      <TT>-64 -mips4</TT>
	    </TD>
	    <TD>
	      Build a 64-bit binary (introduced on IRIX 6.0) using the mips4
	      ISA
	    </TD>
	  </TR>
	</TABLE>
	</DIV>

	<P>

  <DT><B>--with-threads=[SGI_IPC|POSIX]</B>
    <DD>Define the type of threading model to use.  The default is SGI IPC,
	but POSIX is used if compiling on HP-UX.
  <DT><B>--with-jdkhome=[PATH]</B>
    <DD>Give the Java Development Kit (JDK) installation directory.  It
	defaults to <TT>/usr/java</TT>.  This is needed on systems where the
	JDK is not installed in <TT>/usr/java</TT> or <TT>/usr/local/java</TT>
	(the fallback installation directory).
  <DT><B>--with-pfroot=[PATH]</B>
    <DD>Define the root of the Performer installation.  The default is
	<TT>/usr</TT>.
  <DT><B>--with-oglroot=[PATH]</B>
    <DD>Define the root of the OpenGL installation.  The default is
	<TT>/usr</TT>.  This is particularly useful on HP-UX where the OpenGL
	libraries and header files are in <TT>/opt/graphics/OpenGL</TT>.
  <DT><B>--enable-debug</B>
    <DD>Enable (or disable) debugging.  The default is to have debugging 
	turned on.  Enabling debugging defines <B><TT>VJ_DEBUG</TT></B> in
	<TT>vjDefines.h</TT>.
  <DT><B>--enable-opengl</B>
    <DD>Enable the OpenGL API.  This is on by default.  If this is enabled and
	the libraries and header files are found, the OpenGL API code in the
	<TT>Kernel</TT> directory is compiled in.  This also defines
	<B><TT>VJ_API_OPENGL</TT></B> in <TT>vjDefines.h</TT>.
  <DT><B>--enable-perf</B>
    <DD>Enable the Performer API.  This is on by default.  The same holds
	true here as with the OpenGL API.  It defines
	<B><TT>VJ_API_PERFORMER</TT></B> in <TT>vjDefines.h</TT>.
  <DT><B>--with-builddir=[PATH]</B>
    <DD>Define the directory where the library will be built.  This is not
	currently in use.  However, it could prove to be useful later.
</DL>

<HR WIDTH="80%" NOSHADE>

<H3>What <I>configure</I> Actually Does</H3>

<TT>vjDefines.h</TT> is <TT>#include</TT>'d in all source and header files
via <TT>vjConfig.h</TT>.  This file is generated by <I>configure</I> in the
<TT>build</TT> directory when it is run.  In order for the compilers to find
it, <TT>-I.</TT> is added to the include path.  Sample (possibly outdated)
copies of it can be found at:

<PRE>
    ~patrick/samples/vjDefines.h-sgiipc
    ~patrick/samples/vjDefines.h-pthreads
</PRE>

Both of these files were generated using the default values (except for
the threading package in the pthreads copy) for SGIs.

<P>

The <I>configure</I> script will check the host system for the following items
when it is run:

<UL>
  <LI>A check is made for which C and C++ compilers to use.  On both IRIX and
      HP-UX, use of <I>gcc</I>(1) and <I>g++</I>(1) are disallowed by forcing
      the use of the proprietary compilers that have been used for compiling
      developmental versions of libraries.  On HP-UX, use of aC++
      (<I>aCC</I>(1), HP's C++ compiler that implements the ANSI X3J16/ISO
      WG21 C++ Draft Working paper) is required because their <I>CC</I>(1) is
      <I>really</I> lacking in features.  <I>g++</I>(1) 2.7.2.x cannot be used
      because its C++ Standard Template Library support does not meet the
      needs of the library code.  However, <I>egcs</I>(1) is known to meet
      the requirements.
  <LI>If using POSIX threads, it makes sure that the library is there and that
      the header files are in the include path.  On HP-UX, the pthreads code
      and re-entrant C library are combined in the CMA library, so if the
      pthreads library is not found, it falls back on a check for the CMA
      library.  After it figures out which library to link, it determines
      which draft of the POSIX threads standard is in place (either Draft 4
      or Draft 10) by checking for <I>pthread_kill</I>(3) that is part of
      Draft 10 but not Draft 4.  If the libraries or header files are not
      found, the threading implementation falls back on SGI IPC.
  <LI>If using SGI IPC, a check is made for the header file
      <TT>sys/prctl.h.</TT>
  <LI>If neither threading implementation is available, the script exits with
      an error.
  <LI>As mentioned above, if the OpenGL and/or Performer APIs are enabled, it
      checks for the basic libraries (GL and pf respectively) and header
      files.  If not found, the missing API is disabled.  If the OpenGL API is
      not found, the script exits with an error.
  <LI>A check for <I>sginap</I>(2) is made.  If it is not found, an
      <I>sginap</I>() CPP macro using <I>usleep</I>(2) is defined in
      <TT>vjDefines.h</TT>.
  <LI>A check for the header file <TT>sys/z8530.h</TT> is made.  This a file
      that is needed by <TT>Input/vjGlove/vt_serial_io.C</TT> but only exists
      on SGIs.
  <LI>Related to the above check, a check is made for <TT>sys/stdsyms.h</TT>.
      This is a file that defines a lot of CPP macros and such (on HP-UX at
      least) so that they do not need to be defined in our source files.  At
      present, this file is only included by
      <TT>Input/vjGlove/vt_serial_io.C</TT>.
  <LI>Miscellaneous checks are made for several header files and system calls
      that may not actually be necessary but were added when I generated a
      generic <I>configure</I> script.  These can be removed easily if they
      are deemed to be unnecessary.  The checks include looking for
      <TT>strings.h</TT>, <TT>fcntl.h</TT>, <I>gettimeofday</I>(3),
      <I>socket</I>(2), <I>strerror</I>(3), etc.
</UL>

<HR WIDTH="80%" NOSHADE>

<H3>Debugging</H3>

While <I>configure</I> runs, a file called <TT>config.log</TT> is constantly
updated in <I>configure</I>'s working directory.  When something goes wrong
with the configuration process, the first thing to do is refer to the bottom
of this file to see what was done and why it failed.  Debugging the actual
script is more difficult.  Refer to the documentation on
<A HREF="config_maintain.html">maintaining and updating <TT>configure.in</TT>
and <TT>Makefile.in</TT></A> for more information relating to this topic.

<P>

<HR WIDTH="80%" NOSHADE>

<H3>Miscellaneous Notes</H3>

Only the template files that are used for generating other files are in the
CVS repository.  This only matters in the base directory where
<TT>configure.in</TT> is ``compiled'' to make the <I>configure</I> script and
where <TT>acconfig.h</TT> is used to build a <TT>vjDefines.h.in</TT> file.
<I>configure</I> is created by running <I>autoconf</I>(1) on
<TT>configure.in</TT> and <TT>vjDefines.h.in</TT> is created by running
<I>autoheader</I>(1) on <TT>acconfig.h</TT> and <TT>configure.in</TT>.

<P>

If strange errors occur while compiling (after running <I>configure</I>
successfully), check to make sure that all the files are in sync.  The
revision number at the top of <TT>configure.in</TT> (passed as the parameter
to <I>AC_REVISION</I>) and at the top of the <I>configure</I> script must be
the same.  If they are not, run <I>autoconf</I>(1) to update <I>configure</I>
to be in sync with <TT>configure.in</TT>.  Also check the revision number at
the top of <TT>acconfig.h</TT> (in the line reading ``<TT>Generated from
acconfig.h ($Revision x.y$)</TT>'') and at the top of <TT>vjDefines.h.in</TT>.
These two lines should be identical.  If not, run <I>autoheader</I>(1) to
regenerate <TT>vjDefines.h.in</TT> from <TT>acconfig.h</TT>.  What can easily
happen is a new variable could be added to the <TT>Makefile.in</TT> files that
is set with <I>configure</I>, but the revision of <I>configure</I> used will
not know about this new symbol and thus will not substitute a value for it.

<P>

<HR WIDTH="80%" NOSHADE>

</BODY>

</HTML>
