<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html>

<title>Description of ChunkDesc files</title>

<body bgcolor="#ffffcc">

<!--NewPage-->
<h1><img src="juggler.gif" width="29" height="33"></img>
Description of ChunkDesc (ConfigChunk Description) files</h1>

<h2>Overview</h2>

A ChunkDesc file includes descriptions of different kinds of ConfigChunks.
It is a way to configure the configuration system itself. Here's a simple
example, a ChunkDesc file with two entries.

<pre>
chunk flockobirds
 port string 1 port "serial port address"
 offset double 3 offset "tracker coord offset"
 baudrate int 1 baud "serial port rate"
 end
 
chunk display
 name string 1 name "descriptive name"
 origin double 3 origin "other help text"
 size int 2 size ""
 SGIpipe int 1 SGIpipe ""
 xdisplay string 1 xdisplay ""
 stereo bool 1 stereo ""
 lowerleft double 3 lowerleft ""
 lowerright double 3 lowerright ""
 upperleft double 3 upperleft ""
 end

End
</pre>

The first entry defines a chunk type called "flockobirds" that contains
three properties ("port", "offset", and "baudrate"). The second defines
a chunktype called "display" which contains 9 properties.

<P>Each property has a type - for example, the values that "port" can take
will be strings, such as "/dev/ttyd45", while baudrate will always have
integer values.

<P>It is also possible for a property to have a set of values. For example,
the "display" chunk's "lowerleft", "lowerright", and "upperleft" properties
are meant to represent positions in 3d space. These can be represented
by a sequence of three doubles for the x, y, and z coordinates. The number
of values a property supports is listed directly to the right of the type
- the "3" in the line for "lowerleft", or the "1" for "stereo." If a property
might have a variable number of entries (perhaps as a list of active displays,
or such), use the number -1.

<P>The fourth word on each property line is the actual token to be used
to represent this property when reading/writing config files. Most often
this will be the same as the name of the property (which is used internally
for querying a ConfigChunk), but the options is provided to make the config
files more flexible or readable.

<P>The last thing on a property line is a help string. If the help string
contains spaces or is empty, it must be in quotes.


<h2>General Rules</h2>
<ol>
<li>ChunkDesc files are non-case-sensitive.  For example, "end", "End",
and "eND" are all valid ways to end a chunk description or a file.
Similarly, the ChunkDesc system would make no distinction between 
ChunkDescs with the tokens "flock" and "FLOCK".
<li>The following keywords are reserved in ChunkDesc files: <tt>
end, string, int, boolean, chunk, float, vj_valuelabels, vj_enumerations,</tt> and generally any word 
with the prefix <tt>vj_</tt>.
<li>Strings (names, help strings, etc.) should always be surrounded
by quotes.
<li>Strings cannot contain line breaks or quotes (the latter is considered
a parser bug for now)</li>
<li>In general, the ChunkDesc parser treats all whitespace the same,
so it is possible for parts of a line to be broken up for greater
readability.
</ol>

<h2>ChunkDesc Files</h2>

The general format of a ChunkDesc file is:

<pre>
 [ChunkDesc]
 ...
End
</pre>

That is, zero or more ChunkDescs followed by the token <tt>End</tt>.
<p>
Several forms of comments are allowed inside the files.  C-style
comments (/* comment */) can be used to comment out blocks of text.
Shell and C++ comments (# and //) can be used to comment out text to the
next endline character.
<p>
Note that the vjcontrol program does not preserve comments in the files
that it loads and saves, so this is mostly useful as a quick hack or as
a debugging feature.

<h2>ChunkDescs</h2>

The basic format of a ChunkDesc is:

<pre>
chunk "token" "longer name" "help info"
    Name String 1 "Name" ""
    [other Property Descriptions]
    ...
    end
</pre>

The first line contains the token <tt>chunk</tt>, followed by three
strings.  The token is used in programs to refer to the ChunkDesc.
The name is a longer name that is used in graphical interfaces instead
of the token. (The name can contain spaces, the token must not).  The
help info is a string shown in the graphic interface.  All three strings
must be defined, though the help string can be empty ("").
<p>
The first line is followed by one or more Property Descriptions, followed
by the token <tt>end</tt>.  Note that the first property description
must always be for the "Name" property - this is used to give a unique
name to every ConfigChunk using this ChunkDesc.  If there is no "Name"
PropertyDesc, one will be added by the loader.

<h3>Property Description Lines</h3>

The format of a Property Description line is:
<pre>
    "token" type num "Name" [optional stuff] "help"
</pre>
The <tt>Token, Name, and Help</tt> serve the same purposes as in the 
Chunk line described above.
<p>
<tt>Type</tt> refers to the type of value stored in this property. Valid
values are <tt>String, Int, Float, Boolean, and Chunk</tt> (a property
that stores the names of other ConfigChunks).
<p>
<tt>Num</tt> refers to the number of values that this Property can store.
Usually this is 1.  A coordinate in 3d space might be stored with 3 float
values.  A value of -1 in this field means that the property can have a
variable number of values (useful for lists of available components,
directory search paths, etc.).
<p>
There are also two optional fields in a PropertyDesc line, either or both
of which can be placed between the Name and Help fields of the line.
<ul>
<h4><li>Enumerations</h4>
        <p>Sometimes a given Property will have a small number of 
        possible values. For example, in configuring a C2-like device, 
        we might have a description for a Property called
        &quot;ActiveWalls&quot;: </p>

        <pre>
        ActiveWalls String -1 &quot;Active Walls&quot; &quot;&quot;
        </pre>

        <p>Since cubes have six sides, that's probably the total number 
        of possible values we have. We can build that information into 
        the Property definition like so: </p>

        <pre>
        ActiveWalls String -1 &quot;Active Walls&quot; 
          vj_enumerations { &quot;front&quot; &quot;back&quot; 
          &quot;floor&quot; &quot;ceiling&quot; &quot;left&quot; 
          &quot;right&quot; } &quot;&quot;
        </pre>

        <p>The advantage of doing this is that the GUI can prevent someone 
        with a list of the valid options for this property.

        <p>For int and double Properties, enumerations can match 
        descriptive names with numbers, like so (assuming that our 
        application identifies walls with integers instead of strings):

        <pre>
        ActiveWalls Int -1 &quot;Active Walls&quot; 
          vj_enumerations { &quot;front=1&quot; &quot;back=3&quot; 
          &quot;floor=2&quot; } &quot;&quot;
        </pre>

        <p>Note that the entries can be put in any order, and that 
        it is possible for multiple names to refer to the same value. </p>
        <p>If you are editing a ChunkDesc file by hand, you can leave 
        off the &quot;=x&quot; part of the enumeration entries. In this 
        case the loader will automatically assign the values
        0, 1, 2... (or 0.0, 1.0, 2.0...) to the entries as they are read. </p>
        <p>Frankly, you're better off just using the editor. </p>

<h4><li>Value Labels</h4>

        <p>Consider this Property definition: </p>
        <pre>
        Orientation Float 3 &quot;Orientation&quot; &quot;&quot;
        </pre>

        <p>It apparently defines an orientation in 3d space, but how? 
        Euler angles? Azimuth, elevation and roll? Looking at this in the
        vjcontrol GUI, it would be nice to have individual labels next
        to each of the values so we know what's what.
	Value labels let us do that, like so: </p>

        <pre>
        Orientation Float 3 &quot;Orientation&quot; 
           vj_valuelabels { &quot;azimuth&quot; 
               &quot;elevation&quot; &quot;roll&quot; } &quot;&quot;
        </pre>

        <p>Now we know that the first value in Orientation represents 
        the azimuth, the second is elevation, etc. The GUI can display 
        the value labels next to the values' fields. </p>

</ul>

</body>


</html>

